CREATE TABLE AlohAndes(
id int,
CONSTRAINT PKcliente PRIMARY KEY (id)
);
CREATE TABLE Clientes(
documento int,
nombre varchar(32) NOT NULL,
vinculo varchar(32),
CONSTRAINT PKclientes PRIMARY KEY (documento),
CONSTRAINT CKvinculo CHECK (vinculo = 'estudiante' OR vinculo ='padre'OR vinculo ='egresado'OR vinculo ='empleado'OR vinculo ='profesor'OR vinculo ='evento'OR vinculo ='profinvitado')
);
CREATE TABLE ClientesRegistrados(
cliente int,
aloha int,
CONSTRAINT PKclientesRegistrados PRIMARY KEY (cliente,aloha),
CONSTRAINT FKcliente FOREIGN KEY (cliente) REFERENCES Clientes(documento),
CONSTRAINT FKaloha FOREIGN KEY (aloha) REFERENCES AlohAndes(id)
);

CREATE TABLE Reservas(
id int,
diaLlegada date NOT NULL,
diaSalida date NOT NULL,
cancelada char(1) NOT NULL, 
costo int NOT NULL,
CONSTRAINT PKreserva PRIMARY KEY (id),
CONSTRAINT CKsalida CHECK (diaSalida >diaLlegada),
CONSTRAINT CKboolean CHECK (cancelada in ( 'Y', 'N' )),
CONSTRAINT CKcosto CHECK (costo>0)
);
CREATE TABLE ReservaCliente(
cliente int,
reserva int,
CONSTRAINT PKreservaCliente PRIMARY KEY (cliente,reserva),
CONSTRAINT FKclienteReserva FOREIGN KEY (cliente) REFERENCES Clientes(documento),
CONSTRAINT FKreserva FOREIGN KEY (reserva) REFERENCES Reservas(id)
);
CREATE TABLE Operadores(
id int,
nombre int NOT NULL,
CONSTRAINT PKoperadores PRIMARY KEY(id)
);
CREATE TABLE OperadoresRegistrados(
operador int,
aloha int ,
CONSTRAINT PKopReg PRIMARY KEY(operador,aloha),
CONSTRAINT FKoperadorOpeReg FOREIGN KEY (operador) REFERENCES Operadores(id),
CONSTRAINT FKalohaOpReg FOREIGN KEY (aloha) REFERENCES AlohAndes(id)
);
CREATE TABLE Hoteles(
id int,
categoria int NOT NULL,
ubicacion varchar(32) NOT NULL,
registroSI varchar(32) NOT NULL, 
registroCamara varchar(32) NOT NULL,
CONSTRAINT PKhoteles PRIMARY KEY (id),
CONSTRAINT FKoperadorHoteles FOREIGN KEY (id) REFERENCES Operadores(id),
CONSTRAINT CKCateg CHECK (categoria >0 AND categoria<6)
);
CREATE TABLE Hostales(
id int,
categoria int NOT NULL,
ubicacion varchar(32) NOT NULL,
registroSI varchar(32) NOT NULL, 
registroCamara varchar(32) NOT NULL,
horarioApertura varchar(32) NOT NULL,
horarioCierre varchar(32) NOT NULL,
CONSTRAINT PKhostales PRIMARY KEY (id),
CONSTRAINT FKoperadorHostales FOREIGN KEY (id) REFERENCES Operadores(id),
CONSTRAINT CKCategHostal CHECK (categoria >0 AND categoria<6)
);
CREATE TABLE PersonaNatural(
id int,
vinculo varchar(32) NOT NULL,
CONSTRAINT PKpersonaNatural PRIMARY KEY (id),
CONSTRAINT FKoperadorPersonaNatural FOREIGN KEY (id) REFERENCES Operadores(id),
CONSTRAINT CKvinculoPersonaNat CHECK (vinculo = 'estudiante' OR vinculo ='padre'OR vinculo ='egresado'
OR vinculo ='empleado'OR vinculo ='profesor'OR vinculo ='evento'OR vinculo ='profinvitado')
);
CREATE TABLE Habitaciones(
id int,
precio double precision NOT NULL,
descripcion varchar(32) NOT NULL,
periodoFactura int NOT NULL,
CONSTRAINT PKhabitaciones PRIMARY KEY (id),
CONSTRAINT CKprecio CHECK (precio>0 AND periodoFactura>0)
);
CREATE TABLE HabitacionesH(
id int,
capacidad int NOT NULL,
tipo varchar(32),
CONSTRAINT PKhabitacionesH PRIMARY KEY (id),
CONSTRAINT FKidHabitacionesH FOREIGN KEY (id) REFERENCES Habitaciones(id),
CONSTRAINT CKcaphabsh CHECK (capacidad>0)
);
CREATE TABLE ViviendaUniversitaria(
id int,
ubicacion varchar(32) NOT NULL,
capacidad int NOT NULL,
CONSTRAINT PKviviendaUniversitaria PRIMARY KEY (id),
CONSTRAINT FKoperadorVivUni FOREIGN KEY (id) REFERENCES Operadores(id),
CONSTRAINT CKcapacidad CHECK (capacidad>0)
);
CREATE TABLE HabitacionesHotel(
hotel int,
habitacion int,
CONSTRAINT PKhabitacionesHotel PRIMARY KEY(hotel,habitacion),
CONSTRAINT FKhotelHabitacionesHotel FOREIGN KEY (hotel) REFERENCES Hoteles(id),
CONSTRAINT FKhabitacionHabitacionesHotel FOREIGN KEY (habitacion) REFERENCES HabitacionesH(id)
);
CREATE TABLE HabitacionesHostal(
hostal int,
habitacion int,
CONSTRAINT PKhabitacionesHostal PRIMARY KEY(hostal,habitacion),
CONSTRAINT FKhotelHabitacionesHostal FOREIGN KEY (hostal) REFERENCES Hostales(id),
CONSTRAINT FKhabitacionHabitacionesHostal FOREIGN KEY (habitacion) REFERENCES HabitacionesH(id)
);
CREATE TABLE HabitacionUniversitaria(
id int,
compartida char(1) NOT NULL,
ubicacion varchar(32) NOT NULL,
CONSTRAINT PKhabitacionUniversitaria PRIMARY KEY (id),
CONSTRAINT FKidHabitacionUniversitaria FOREIGN KEY (id) REFERENCES Habitaciones(id),
CONSTRAINT CKbooleanCompartida CHECK (compartida in ( 'Y', 'N' ))
);
CREATE TABLE HabitacionesUniversitarias(
operador int,
habitacion int,
CONSTRAINT PKhabitacionesUniversitarias PRIMARY KEY(operador,habitacion),
CONSTRAINT FKoperadorHabsUni FOREIGN KEY (operador) REFERENCES ViviendaUniversitaria(id),
CONSTRAINT FKhabitacionHabsUni FOREIGN KEY (habitacion) REFERENCES Habitaciones(id)
);
CREATE TABLE Apartamentos(
id int,
operador int,
precio double precision NOT NULL,
administracion double precision NOT NULL,
amoblado char(1) NOT NULL,
CONSTRAINT PKapartamentos PRIMARY KEY (id),
CONSTRAINT FKapartamentos FOREIGN KEY (operador) REFERENCES Operadores(id),
CONSTRAINT CKbooleanAmoblado CHECK (amoblado in ( 'Y', 'N' )),
CONSTRAINT CKprecioapto CHECK(precio>0)
);
CREATE TABLE HabitacionesVivienda(
id int,
operador int,
nombre varchar(32) NOT NULL,
compartida char(1) NOT NULL,
CONSTRAINT PKHabsVivi PRIMARY KEY (id),
CONSTRAINT FKoperadorHabsVivi FOREIGN KEY (operador) REFERENCES Operadores(id),
CONSTRAINT FKidHabsVivi FOREIGN KEY (id) REFERENCES Habitaciones(id),
CONSTRAINT CKbooleanCompa CHECK (compartida in ( 'Y', 'N' ))
);
CREATE TABLE Viviendas(
id int,
operador int,
precio double precision NOT NULL,
CONSTRAINT PKViviendas PRIMARY KEY (id),
CONSTRAINT FKoperadorVivi FOREIGN KEY (operador) REFERENCES Operadores(id),
CONSTRAINT CKpreciovivi CHECK(precio>0)
);
CREATE TABLE Servicios(
id int,
tipo varchar(32) NOT NULL,
nombre varchar(32) NOT NULL,
descripcion varchar(32) NOT NULL, 
costo double precision NOT NULL,
CONSTRAINT PKserviciosS PRIMARY KEY (id),
CONSTRAINT CKprecioviviservi CHECK(costo>0)
);
CREATE TABLE ServiciosOperadores(
servicio int,
operador int,
CONSTRAINT PKServiciosOperadores PRIMARY KEY(operador,servicio),
CONSTRAINT FKoperadorServiciosOperadores FOREIGN KEY (operador) REFERENCES Operadores(id),
CONSTRAINT FKservicioServiciosOperadores FOREIGN KEY (servicio) REFERENCES Servicios(id)
);
CREATE TABLE ServiciosHabitaciones(
servicio int,
habitacion int,
CONSTRAINT PKServiciosHabitaciones PRIMARY KEY(habitacion,servicio),
CONSTRAINT FKhabitacionServsHabs FOREIGN KEY (habitacion) REFERENCES Habitaciones(id),
CONSTRAINT FKservicioServsHabs FOREIGN KEY (servicio) REFERENCES Servicios(id)
);
  CREATE TABLE Ofertas (
	id int, 
	longitudEstadia int NOT NULL, 
	precioEstadia double precision NOT NULL, 
	nombre varchar(32) NOT NULL, 
	ubicacion varchar(32)NOT NULL, 
	descripcion varchar(32) NOT NULL, 
	fechaPublicacion DATE NOT NULL, 
	operador int NOT NULL, 
	habitacion int, 
	apartamento int, 
	vivienda int, 
	 CONSTRAINT PKofertas PRIMARY KEY (id),
	 CONSTRAINT FKOperadorOferta FOREIGN KEY (operador) REFERENCES Operadores (id), 
	 CONSTRAINT FKhabitacionOferta FOREIGN KEY (habitacion) REFERENCES Habitaciones(id), 
	 CONSTRAINT FKapartamentoOferta FOREIGN KEY(apartamento)REFERENCES Apartamentos(id), 
	 CONSTRAINT FKviviendaOferta FOREIGN KEY (vivienda)REFERENCES Viviendas(id),
     CONSTRAINT CKofertas CHECK (precioEstadia>0 AND longitudEstadia>0)
   );

CREATE TABLE OfertasOfrecidas(
oferta int,
aloha int,
CONSTRAINT PKOfertasOfrecidas PRIMARY KEY (oferta,aloha),
CONSTRAINT FKofertaOfOf FOREIGN KEY (oferta) REFERENCES Ofertas(id),
CONSTRAINT FKalohaOfOf FOREIGN KEY (aloha) REFERENCES AlohAndes(id)
);
CREATE TABLE ReservasOferta(
oferta int,
reserva int,
CONSTRAINT PKReservasOferta PRIMARY KEY (oferta,reserva),
CONSTRAINT FKofertaReservasOferta FOREIGN KEY (oferta) REFERENCES Ofertas(id),
CONSTRAINT FKreservaReservasOferta FOREIGN KEY (reserva) REFERENCES Reservas(id)
);
